{
	"name": "CVE-2023-52792",
	"seq": "2023-52792",
	"type": "CAN",
	"status": "Candidate",
	"phase": {
		"text": "Assigned",
		"date": "20240521"
	},
	"desc": "In the Linux kernel, the following vulnerability has been resolved: cxl/region: Do not try to cleanup after cxl_region_setup_targets() fails Commit 5e42bcbc3fef (\"cxl/region: decrement ->nr_targets on error in cxl_region_attach()\") tried to avoid 'eiw' initialization errors when ->nr_targets exceeded 16, by just decrementing ->nr_targets when cxl_region_setup_targets() failed. Commit 86987c766276 (\"cxl/region: Cleanup target list on attach error\") extended that cleanup to also clear cxled->pos and p->targets[pos]. The initialization error was incidentally fixed separately by: Commit 8d4285425714 (\"cxl/region: Fix port setup uninitialized variable warnings\") which was merged a few days after 5e42bcbc3fef. But now the original cleanup when cxl_region_setup_targets() fails prevents endpoint and switch decoder resources from being reused: 1) the cleanup does not set the decoder's region to NULL, which results in future dpa_size_store() calls returning -EBUSY 2) the decoder is not properly freed, which results in future commit errors associated with the upstream switch Now that the initialization errors were fixed separately, the proper cleanup for this case is to just return immediately. Then the resources associated with this target get cleanup up as normal when the failed region is deleted. The ->nr_targets decrement in the error case also helped prevent a p->targets[] array overflow, so add a new check to prevent against that overflow. Tested by trying to create an invalid region for a 2 switch * 2 endpoint topology, and then following up with creating a valid region.",
	"refs": [
		{
			"text": "https://git.kernel.org/stable/c/0718588c7aaa7a1510b4de972370535b61dddd0d",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/0718588c7aaa7a1510b4de972370535b61dddd0d"
		},
		{
			"text": "https://git.kernel.org/stable/c/07ffcd8ec79cf7383e1e45815f4842fd357991c2",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/07ffcd8ec79cf7383e1e45815f4842fd357991c2"
		},
		{
			"text": "https://git.kernel.org/stable/c/9090c5537c93cd0811ab7bfbd925b57addfffb60",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/9090c5537c93cd0811ab7bfbd925b57addfffb60"
		},
		{
			"text": "https://git.kernel.org/stable/c/90db4c1d5ebaf574d3c3065c055977982c378a83",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/90db4c1d5ebaf574d3c3065c055977982c378a83"
		}
	],
	"votes": {}
}
