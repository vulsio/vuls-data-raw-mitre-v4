{
	"name": "CVE-2024-38558",
	"seq": "2024-38558",
	"type": "CAN",
	"status": "Candidate",
	"phase": {
		"text": "Assigned",
		"date": "20240618"
	},
	"desc": "In the Linux kernel, the following vulnerability has been resolved: net: openvswitch: fix overwriting ct original tuple for ICMPv6 OVS_PACKET_CMD_EXECUTE has 3 main attributes: - OVS_PACKET_ATTR_KEY - Packet metadata in a netlink format. - OVS_PACKET_ATTR_PACKET - Binary packet content. - OVS_PACKET_ATTR_ACTIONS - Actions to execute on the packet. OVS_PACKET_ATTR_KEY is parsed first to populate sw_flow_key structure with the metadata like conntrack state, input port, recirculation id, etc. Then the packet itself gets parsed to populate the rest of the keys from the packet headers. Whenever the packet parsing code starts parsing the ICMPv6 header, it first zeroes out fields in the key corresponding to Neighbor Discovery information even if it is not an ND packet. It is an 'ipv6.nd' field. However, the 'ipv6' is a union that shares the space between 'nd' and 'ct_orig' that holds the original tuple conntrack metadata parsed from the OVS_PACKET_ATTR_KEY. ND packets should not normally have conntrack state, so it's fine to share the space, but normal ICMPv6 Echo packets or maybe other types of ICMPv6 can have the state attached and it should not be overwritten. The issue results in all but the last 4 bytes of the destination address being wiped from the original conntrack tuple leading to incorrect packet matching and potentially executing wrong actions in case this packet recirculates within the datapath or goes back to userspace. ND fields should not be accessed in non-ND packets, so not clearing them should be fine. Executing memset() only for actual ND packets to avoid the issue. Initializing the whole thing before parsing is needed because ND packet may not contain all the options. The issue only affects the OVS_PACKET_CMD_EXECUTE path and doesn't affect packets entering OVS datapath from network interfaces, because in this case CT metadata is populated from skb after the packet is already parsed.",
	"refs": [
		{
			"text": "https://git.kernel.org/stable/c/0b532f59437f688563e9c58bdc1436fefa46e3b5",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/0b532f59437f688563e9c58bdc1436fefa46e3b5"
		},
		{
			"text": "https://git.kernel.org/stable/c/431e9215576d7b728f3f53a704d237a520092120",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/431e9215576d7b728f3f53a704d237a520092120"
		},
		{
			"text": "https://git.kernel.org/stable/c/483eb70f441e2df66ade78aa7217e6e4caadfef3",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/483eb70f441e2df66ade78aa7217e6e4caadfef3"
		},
		{
			"text": "https://git.kernel.org/stable/c/5ab6aecbede080b44b8e34720ab72050bf1e6982",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/5ab6aecbede080b44b8e34720ab72050bf1e6982"
		},
		{
			"text": "https://git.kernel.org/stable/c/6a51ac92bf35d34b4996d6eb67e2fe469f573b11",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/6a51ac92bf35d34b4996d6eb67e2fe469f573b11"
		},
		{
			"text": "https://git.kernel.org/stable/c/78741b4caae1e880368cb2f5110635f3ce45ecfd",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/78741b4caae1e880368cb2f5110635f3ce45ecfd"
		},
		{
			"text": "https://git.kernel.org/stable/c/7c988176b6c16c516474f6fceebe0f055af5eb56",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/7c988176b6c16c516474f6fceebe0f055af5eb56"
		},
		{
			"text": "https://git.kernel.org/stable/c/9ec8b0ccadb908d92f7ee211a4eff05fd932f3f6",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/9ec8b0ccadb908d92f7ee211a4eff05fd932f3f6"
		},
		{
			"text": "https://git.kernel.org/stable/c/d73fb8bddf89503c9fae7c42e50d44c89909aad6",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/d73fb8bddf89503c9fae7c42e50d44c89909aad6"
		}
	],
	"votes": {}
}
