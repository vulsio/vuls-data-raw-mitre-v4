{
	"name": "CVE-2024-35910",
	"seq": "2024-35910",
	"type": "CAN",
	"status": "Candidate",
	"phase": {
		"text": "Assigned",
		"date": "20240517"
	},
	"desc": "In the Linux kernel, the following vulnerability has been resolved: tcp: properly terminate timers for kernel sockets We had various syzbot reports about tcp timers firing after the corresponding netns has been dismantled. Fortunately Josef Bacik could trigger the issue more often, and could test a patch I wrote two years ago. When TCP sockets are closed, we call inet_csk_clear_xmit_timers() to 'stop' the timers. inet_csk_clear_xmit_timers() can be called from any context, including when socket lock is held. This is the reason it uses sk_stop_timer(), aka del_timer(). This means that ongoing timers might finish much later. For user sockets, this is fine because each running timer holds a reference on the socket, and the user socket holds a reference on the netns. For kernel sockets, we risk that the netns is freed before timer can complete, because kernel sockets do not hold reference on the netns. This patch adds inet_csk_clear_xmit_timers_sync() function that using sk_stop_timer_sync() to make sure all timers are terminated before the kernel socket is released. Modules using kernel sockets close them in their netns exit() handler. Also add sock_not_owned_by_me() helper to get LOCKDEP support : inet_csk_clear_xmit_timers_sync() must not be called while socket lock is held. It is very possible we can revert in the future commit 3a58f13a881e (\"net: rds: acquire refcount on TCP sockets\") which attempted to solve the issue in rds only. (net/smc/af_smc.c and net/mptcp/subflow.c have similar code) We probably can remove the check_net() tests from tcp_out_of_resources() and __tcp_close() in the future.",
	"refs": [
		{
			"text": "https://git.kernel.org/stable/c/151c9c724d05d5b0dd8acd3e11cb69ef1f2dbada",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/151c9c724d05d5b0dd8acd3e11cb69ef1f2dbada"
		},
		{
			"text": "https://git.kernel.org/stable/c/2e43d8eba6edd1cf05a3a20fdd77688fa7ec16a4",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/2e43d8eba6edd1cf05a3a20fdd77688fa7ec16a4"
		},
		{
			"text": "https://git.kernel.org/stable/c/44e62f5d35678686734afd47c6a421ad30772e7f",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/44e62f5d35678686734afd47c6a421ad30772e7f"
		},
		{
			"text": "https://git.kernel.org/stable/c/899265c1389fe022802aae73dbf13ee08837a35a",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/899265c1389fe022802aae73dbf13ee08837a35a"
		},
		{
			"text": "https://git.kernel.org/stable/c/91b243de910a9ac8476d40238ab3dbfeedd5b7de",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/91b243de910a9ac8476d40238ab3dbfeedd5b7de"
		},
		{
			"text": "https://git.kernel.org/stable/c/93f0133b9d589cc6e865f254ad9be3e9d8133f50",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/93f0133b9d589cc6e865f254ad9be3e9d8133f50"
		},
		{
			"text": "https://git.kernel.org/stable/c/c1ae4d1e76eacddaacb958b67cd942082f800c87",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/c1ae4d1e76eacddaacb958b67cd942082f800c87"
		},
		{
			"text": "https://git.kernel.org/stable/c/e3e27d2b446deb1f643758a0c4731f5c22492810",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/e3e27d2b446deb1f643758a0c4731f5c22492810"
		}
	],
	"votes": {}
}
