{
	"name": "CVE-2024-35960",
	"seq": "2024-35960",
	"type": "CAN",
	"status": "Candidate",
	"phase": {
		"text": "Assigned",
		"date": "20240517"
	},
	"desc": "In the Linux kernel, the following vulnerability has been resolved: net/mlx5: Properly link new fs rules into the tree Previously, add_rule_fg would only add newly created rules from the handle into the tree when they had a refcount of 1. On the other hand, create_flow_handle tries hard to find and reference already existing identical rules instead of creating new ones. These two behaviors can result in a situation where create_flow_handle 1) creates a new rule and references it, then 2) in a subsequent step during the same handle creation references it again, resulting in a rule with a refcount of 2 that is not linked into the tree, will have a NULL parent and root and will result in a crash when the flow group is deleted because del_sw_hw_rule, invoked on rule deletion, assumes node->parent is != NULL. This happened in the wild, due to another bug related to incorrect handling of duplicate pkt_reformat ids, which lead to the code in create_flow_handle incorrectly referencing a just-added rule in the same flow handle, resulting in the problem described above. Full details are at [1]. This patch changes add_rule_fg to add new rules without parents into the tree, properly initializing them and avoiding the crash. This makes it more consistent with how rules are added to an FTE in create_flow_handle.",
	"refs": [
		{
			"text": "https://git.kernel.org/stable/c/1263b0b26077b1183c3c45a0a2479573a351d423",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/1263b0b26077b1183c3c45a0a2479573a351d423"
		},
		{
			"text": "https://git.kernel.org/stable/c/2e8dc5cffc844dacfa79f056dea88002312f253f",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/2e8dc5cffc844dacfa79f056dea88002312f253f"
		},
		{
			"text": "https://git.kernel.org/stable/c/3d90ca9145f6b97b38d0c2b6b30f6ca6af9c1801",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/3d90ca9145f6b97b38d0c2b6b30f6ca6af9c1801"
		},
		{
			"text": "https://git.kernel.org/stable/c/5cf5337ef701830f173b4eec00a4f984adeb57a0",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/5cf5337ef701830f173b4eec00a4f984adeb57a0"
		},
		{
			"text": "https://git.kernel.org/stable/c/7aaee12b804c5e0374e7b132b6ec2158ff33dd64",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/7aaee12b804c5e0374e7b132b6ec2158ff33dd64"
		},
		{
			"text": "https://git.kernel.org/stable/c/7c6782ad4911cbee874e85630226ed389ff2e453",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/7c6782ad4911cbee874e85630226ed389ff2e453"
		},
		{
			"text": "https://git.kernel.org/stable/c/adf67a03af39095f05d82050f15813d6f700159d",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/adf67a03af39095f05d82050f15813d6f700159d"
		},
		{
			"text": "https://git.kernel.org/stable/c/de0139719cdda82806a47580ca0df06fc85e0bd2",
			"source": "MISC",
			"url": "https://git.kernel.org/stable/c/de0139719cdda82806a47580ca0df06fc85e0bd2"
		}
	],
	"votes": {}
}
